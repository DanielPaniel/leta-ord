<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Ord</title>
        <style>
            :root {
                --wf-font: monospace;
                overscroll-behavior: none;   
                
                --rainbow-1: #f8d1f8;
                --rainbow-2: #a5a7ff;
                --rainbow-3: #a5eaff;
                --rainbow-4: #95ffdf;
                --rainbow-5: #c4faa1;
                --rainbow-6: #ffffb1;
                --rainbow-7: #ffdea8;
            }
  
            main {
                width: min-content;
                margin: auto;
            }

            header {
                font-family: var(--wf-font);

                display: flex;
                padding-block: .5rem;
            }
            header button {
                margin-inline: auto 0;
                font-family: var(--wf-font);
                font-weight: bold;
                font-size: 1.2em;

            } 
            h1 {
                margin: 0;
                padding: 0;
                font-size: 1.5em;
            }

            dialog {
                --foreground: #fff;
                --background: #333;

                font-family: var(--wf-font);
                font-size: 1.5em;
                background: transparent;
                border: none;

                color: var(--foreground);
                padding-block: 0;
                padding-inline: 0;
                width: min(80vw, 20em);
            }
            dialog::backdrop {
                background: rgba(0,0,0,.5);
                backdrop-filter: blur(10px);
            }
            .dialog-container {
                padding-block: 1em;
                padding-inline: 2em;
                border: 1px solid var(--foreground);
                border-radius: .2em;
                background: var(--background);
            }
            #menu {
                display: flex;
                flex-flow: row wrap;
                gap: 1em;
            }
            #menu a {
                font-family: var(--wf-font);
                font-weight: bold;
                font-size: 1em;
                background: #fff3;
                border: 1px solid var(--foreground);
                color: var(--foreground);
                text-transform: capitalize;
                cursor: pointer;
                padding: .3em .5em;
                border-radius: .2em;
            }
            .list {
                display: flex;
                flex-flow: row wrap;
                gap: .75em;
                margin-block: 1em;
                padding: 0;
                list-style: none;
            }
            .list li {
                color: black;
                font-family: var(--wf-font);
                font-size: 1.2em;
                text-transform: uppercase;
                font-weight: bold;
                margin: 0;
                padding: 0;
                line-height: 1;
                padding-block: .4em .3em;
                padding-inline: .75em;
                background: #eee;
                border: 1px solid #ccc;
                border-radius: 1em;
            }
        </style>

        <script src="./js/Letter.js"></script>
        <script src="./js/GameBoard.js"></script>
        <script src="./js/GameEngine.js"></script>
    </head>
    <body>

        <main>
            <header>
                <h1>Hitta ord</h1>
                <button>Nytt</button>
            </header>

            <wf-game-engine dimension="8" max-words="4">
            </wf-game-engine>
            
            <dialog>
                <div class="dialog-container">
                    <h2>Nytt spel</h2>
                    <div id="menu"></div>
                </div>
            </dialog>
        </main>

        <script type="module">
            fetch('./wordlists.json')
                .then((response) => response.json())
                .then((json) => {
                    setupDialogMenu(json.wordlists);
                    return json;
                })
                .then((json) => {
                    let query = new URLSearchParams(window.location.search);
                    let selectedList;
                    if (query.has("wordlist")) {
                        let listName = query.get("wordlist");
                        selectedList = json.wordlists.find((list) => Object.keys(list)[0] === listName);
                    } else {
                        selectedList = json.wordlists[(Math.floor(Math.random() * json.wordlists.length))];
                    }
                    return selectedList;
                })
                .then((wordlist) => {
                    let game = document.querySelector("wf-game-engine");
                    game.append(createList(wordlist));
                    game.addEventListener("wf-game-complete", () => {
                        let dialog = document.querySelector("dialog");
                        setTimeout(() => dialog.showModal(), 4000);
                    });

                });
            
            
                function createList(wordlist) {
                    let listElement = document.createElement("ul");
                    listElement.classList.add("list");
                    for(let nameOfList in wordlist) {
                        listElement.setAttribute("data-wf-wordlist", nameOfList);
                        wordlist[nameOfList].forEach(word => {
                            let listItem = document.createElement("li");
                            listItem.innerText = word;
                            listElement.append(listItem);
                        });
                    }
                    return listElement;
                }

                function setupDialogMenu(wordlists) {
                    createMenu(wordlists);
                    let dialog = document.querySelector("dialog");
                    let menuButton = document.querySelector("header button");
                    menuButton.addEventListener("click", () => {
                        dialog.showModal();
                    });
                    dialog.addEventListener("click", (event) => {
                        if (event.target === dialog) {
                            dialog.close();
                        }
                    });

                }

                function createMenu(wordlists) {
                    let dialog = document.querySelector("dialog");
                    let menuElement = document.querySelector("#menu");
                    wordlists.forEach((list) => {
                        let wordlistName = Object.keys(list)[0];
                        let listLink = document.createElement("a");
                        listLink.setAttribute("href", `?wordlist=${wordlistName}`);
                        listLink.text = wordlistName;
                        menuElement.append(listLink);
                    });
                }

                function resetGame() {
                    let currentWordlist = document.querySelector("wf-game-engine ul[data-wf-wordlist]");
                    currentWordlist.remove();
                }
        </script>
    </body>
</html>